import{u as q,a as M,r as a,j as e}from"./index-B3rLLOD9.js";const $="https://script.google.com/macros/s/AKfycbznDdZ59fSqQecC1QZQauoo2Xntebc6gJrhygNOLlb5XSXjPMG6XYTky07adIUSATYuxg/exec";async function L(u){try{return await(await fetch($,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"draft",data:u})})).json()}catch(r){return console.error("Draft save ERROR:",r),{success:!1,error:r.message}}}function J(){const u=q(),{cart:r}=M(),s=r&&r.length?r[0]:null,[m,C]=a.useState(""),[o,P]=a.useState(""),[l,I]=a.useState(""),[j,k]=a.useState(""),[p,R]=a.useState(""),[v,U]=a.useState(""),[h,b]=a.useState(s?s.title:""),[c,N]=a.useState(s&&s.price||""),[y,S]=a.useState(!1);a.useEffect(()=>{s&&(b(s.title),N(s.price||""))},[s]);function A(){return m.trim()?o.trim()?/^\S+@\S+\.\S+$/.test(o)?!l.trim()||l.trim().length<6?"Valid phone required":p.trim()?h.trim()?c?null:"Amount required":"Select a product":"Address required":"Enter valid Email ID":"Email is required":"Name is required"}function E(t,i,n,x){const f=encodeURIComponent(t),d=encodeURIComponent(i),g=encodeURIComponent(n),w=encodeURIComponent(String(x));return`upi://pay?pa=${f}&pn=${d}&tn=${g}&am=${w}&cu=INR`}async function D(t){t.preventDefault();const i=A();if(i)return alert(i);const n={name:m,email:o,phone:l,gender:j,address:p,upiId:v,productName:h,amount:c};sessionStorage.setItem("checkout_draft",JSON.stringify(n));try{S(!0),await L(n)}catch(O){console.warn("Draft save failed",O)}S(!1);const x="merchant@upi",f="SanthoshMobiles",d=`SM-${Date.now()}`,g=E(x,f,d,c);window.confirm("You will be redirected to UPI apps (GPay / PhonePe / Paytm). After payment, come back and confirm your order.")&&(n.orderRef=d,sessionStorage.setItem("checkout_draft",JSON.stringify(n)),window.location.href=g)}return e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Checkout — Manual UPI"}),e.jsxs("form",{onSubmit:D,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Name *"}),e.jsx("input",{className:"w-full border p-2 rounded",value:m,onChange:t=>C(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Email ID *"}),e.jsx("input",{type:"email",className:"w-full border p-2 rounded",value:o,onChange:t=>P(t.target.value),placeholder:"example@gmail.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Phone *"}),e.jsx("input",{className:"w-full border p-2 rounded",value:l,onChange:t=>I(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Gender"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:j,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"",children:"Prefer not to say"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Full Shipping Address *"}),e.jsx("textarea",{className:"w-full border p-2 rounded",value:p,onChange:t=>R(t.target.value),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Product"}),e.jsx("input",{className:"w-full border p-2 rounded",value:h,onChange:t=>b(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Amount (INR)"}),e.jsx("input",{className:"w-full border p-2 rounded",value:c,onChange:t=>N(t.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Your UPI ID (optional)"}),e.jsx("input",{className:"w-full border p-2 rounded",value:v,onChange:t=>U(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:y,className:"px-4 py-2 bg-green-600 text-white rounded",children:y?"Processing...":"Pay with UPI"}),e.jsx("button",{type:"button",onClick:()=>u("/confirm"),className:"px-3 py-2 border rounded",children:"I already paid — Confirm"})]}),e.jsx("div",{className:"text-sm text-yellow-700",children:"Orders are dispatched only after payment verification."})]})]})}export{J as default};
