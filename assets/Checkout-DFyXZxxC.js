import{u as M,a as $,r as s,j as e}from"./index-D89ghn4S.js";const q="https://script.google.com/macros/s/AKfycbyZn3hERrmuATHMoOADARri9ewATpzuJOmJW1xBkksBl2XOHptfeFB18lUQXFa5eQ-xlw/exec";async function F(u){try{return await(await fetch(q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"draft",data:u})})).json()}catch(r){return console.error("Draft save ERROR:",r),{success:!1,error:r.message}}}function B(){const u=M(),{cart:r}=$(),a=r&&r.length?r[0]:null,[m,k]=s.useState(""),[o,C]=s.useState(""),[l,P]=s.useState(""),[v,I]=s.useState(""),[p,R]=s.useState(""),[j,A]=s.useState(""),[h,b]=s.useState(a?a.title:""),[i,N]=s.useState(a&&a.price||""),[y,w]=s.useState(!1);s.useEffect(()=>{a&&(b(a.title),N(a.price||""))},[a]);function U(){return m.trim()?o.trim()?/^\S+@\S+\.\S+$/.test(o)?!l.trim()||l.trim().length<6?"Valid phone required":p.trim()?h.trim()?i?null:"Amount required":"Select a product":"Address required":"Enter valid Email ID":"Email is required":"Name is required"}function E(t,c,n,x){const f=encodeURIComponent(t),d=encodeURIComponent(c),g=encodeURIComponent(n),S=encodeURIComponent(String(x));return`upi://pay?pa=${f}&pn=${d}&tn=${g}&am=${S}&cu=INR`}async function O(t){t.preventDefault();const c=U();if(c)return alert(c);const n={name:m,email:o,phone:l,gender:v,address:p,upiId:j,productName:h,amount:i};sessionStorage.setItem("checkout_draft",JSON.stringify(n));try{w(!0),await F(n)}catch(D){console.warn("Draft save failed",D)}w(!1);const x="santhoshkumarchandru-1@okaxis",f="SanthoshMobiles",d=`SM-${Date.now()}`,g=E(x,f,d,i);window.confirm("You will be redirected to UPI apps (GPay / PhonePe / Paytm). After payment, come back and confirm your order.")&&(n.orderRef=d,sessionStorage.setItem("checkout_draft",JSON.stringify(n)),window.location.href=g)}return e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Checkout — Manual UPI"}),e.jsxs("form",{onSubmit:O,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Name *"}),e.jsx("input",{className:"w-full border p-2 rounded",value:m,onChange:t=>k(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Email ID *"}),e.jsx("input",{type:"email",className:"w-full border p-2 rounded",value:o,onChange:t=>C(t.target.value),placeholder:"example@gmail.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Phone *"}),e.jsx("input",{className:"w-full border p-2 rounded",value:l,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Gender"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:v,onChange:t=>I(t.target.value),children:[e.jsx("option",{value:"",children:"Prefer not to say"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Full Shipping Address *"}),e.jsx("textarea",{className:"w-full border p-2 rounded",value:p,onChange:t=>R(t.target.value),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Product"}),e.jsx("input",{className:"w-full border p-2 rounded",value:h,onChange:t=>b(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Amount (INR)"}),e.jsx("input",{className:"w-full border p-2 rounded",value:i,onChange:t=>N(t.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Your UPI ID (optional)"}),e.jsx("input",{className:"w-full border p-2 rounded",value:j,onChange:t=>A(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:y,className:"px-4 py-2 bg-green-600 text-white rounded",children:y?"Processing...":"Pay with UPI"}),e.jsx("button",{type:"button",onClick:()=>u("/confirm"),className:"px-3 py-2 border rounded",children:"I already paid — Confirm"})]}),e.jsx("div",{className:"text-sm text-yellow-700",children:"Orders are dispatched only after payment verification."})]})]})}export{B as default};
