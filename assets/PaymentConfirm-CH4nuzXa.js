import{u as x,r as n,j as r}from"./index--cBXSqyb.js";const y="https://script.google.com/macros/s/AKfycbznDdZ59fSqQecC1QZQauoo2Xntebc6gJrhygNOLlb5XSXjPMG6XYTky07adIUSATYuxg/exec";function N(o){return new Promise((e,i)=>{const t=new FileReader;t.onload=()=>{const l=t.result.split(",")[1];e(l)},t.onerror=i,t.readAsDataURL(o)})}function I(){const o=x(),[e,i]=n.useState(null),[t,l]=n.useState(""),[s,f]=n.useState(null),[d,u]=n.useState(!1);if(n.useEffect(()=>{const a=sessionStorage.getItem("checkout_draft");a&&i(JSON.parse(a))},[]),!e)return r.jsx("div",{className:"p-4",children:"No checkout data"});async function g(a){if(a.preventDefault(),!t.trim())return alert("Enter transaction ID");if(!s)return alert("Upload payment screenshot");if(!["image/jpeg","image/jpg","image/png"].includes(s.type))return alert("Only JPG / JPEG / PNG images allowed");if(s.size>6*1024*1024)return alert("Image must be under 6 MB");u(!0);try{const m=await N(s),h={action:"order",customerName:e.name,phone:e.phone,gender:e.gender,address:e.address,productName:e.productName,amount:e.amount,upiId:e.upiId,email:e.email,transactionId:t,screenshot:m,screenshotType:s.type},p=await(await fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})).text();let c={};try{c=JSON.parse(p)}catch{alert(`Server did not return valid JSON:
`+p);return}c.success?(alert("Order uploaded successfully!"),sessionStorage.removeItem("checkout_draft"),o("/")):alert(c.error||"Order submission failed")}catch{alert("Upload failed â€” network or script error")}finally{u(!1)}}return r.jsxs("div",{className:"max-w-xl mx-auto p-4",children:[r.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Confirm Payment"}),r.jsxs("form",{onSubmit:g,className:"space-y-3",children:[r.jsx("input",{className:"w-full border p-2 rounded",placeholder:"Transaction ID",value:t,onChange:a=>l(a.target.value)}),r.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:a=>f(a.target.files[0]||null)}),r.jsx("button",{disabled:d,className:"px-4 py-2 bg-indigo-600 text-white rounded",children:d?"Uploading...":"Confirm Order"})]})]})}export{I as default};
